<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Transfer Exchange message tracking logs to Mysql with Talend Open Studio" /><meta name="author" content="Bwilliamson" /><meta property="og:locale" content="en" /><meta name="description" content="In short, we are pushing a csv into a database on a schedule using Talend Open Studio as our ETL tool." /><meta property="og:description" content="In short, we are pushing a csv into a database on a schedule using Talend Open Studio as our ETL tool." /><link rel="canonical" href="https://bwilliamson55.github.io/posts/Transfer-Exchange-message-tracking-logs-to-Mysql-with-Talend-Open-Studio/" /><meta property="og:url" content="https://bwilliamson55.github.io/posts/Transfer-Exchange-message-tracking-logs-to-Mysql-with-Talend-Open-Studio/" /><meta property="og:site_name" content="Bwilliamson’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-22T19:31:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Transfer Exchange message tracking logs to Mysql with Talend Open Studio" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Bwilliamson" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Bwilliamson"},"description":"In short, we are pushing a csv into a database on a schedule using Talend Open Studio as our ETL tool.","url":"https://bwilliamson55.github.io/posts/Transfer-Exchange-message-tracking-logs-to-Mysql-with-Talend-Open-Studio/","@type":"BlogPosting","headline":"Transfer Exchange message tracking logs to Mysql with Talend Open Studio","dateModified":"2021-08-22T19:31:00-04:00","datePublished":"2021-08-22T19:31:00-04:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://bwilliamson55.github.io/posts/Transfer-Exchange-message-tracking-logs-to-Mysql-with-Talend-Open-Studio/"},"@context":"https://schema.org"}</script><title>Transfer Exchange message tracking logs to Mysql with Talend Open Studio | Bwilliamson's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Bwilliamson's Blog"><meta name="application-name" content="Bwilliamson's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Bwilliamson's Blog</a></div><div class="site-subtitle font-italic">More Dude, less Walter</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/bwilliamson55" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['BenjaminAwilliamson','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/benjamin-williamson/" aria-label="linkedin" > <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Transfer Exchange message tracking logs to Mysql with Talend Open Studio</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Transfer Exchange message tracking logs to Mysql with Talend Open Studio</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Bwilliamson </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Aug 22, 2021, 7:31 PM -0400" >Aug 22<i class="unloaded">2021-08-22T19:31:00-04:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2464 words">13 min read</span></div></div><div class="post-content"><p>In short, we are pushing a csv into a database on a schedule using Talend Open Studio as our ETL tool.</p><p>For this post though, we’re getting specific with exchange tracking logs, as this was a fun task I had once so it’s a real world example. I did a short post about how I generated the csv <a href="/posts/Extract-Exchange-message-tracking-logs-with-powershell/">here.</a></p><p>The following is a step by step overview. I suppose it could substitute for a hands-on crash course in basic Talend as well.</p><h1 id="what-the-heck-is-talend-and-etl">What the heck is Talend and ETL</h1><p>Before we dive into this job, some people may be asking this question.</p><p><strong>ETL</strong> stands for <em>Extract, Transform, Load</em><br /> You may have seen or heard of some common ETL tools. Many of these tools are now services with subscriptions per row of data transferred. I used <a href="https://www.stitchdata.com/">Stitch</a> for a while and loved it. But my budget did not.</p><p><strong>Talend Open Studio</strong> is an ETL tool.<br /> <strong><em>It’s also Free</em></strong></p><p>You can learn more about this awesome tool <a href="https://www.talend.com/products/integrate-data/">here</a>.<br /> Bookmark their forums (You’ll need them) <a href="https://community.talend.com/s/?language=en_US">here</a>.<br /> Bookmark their docs <a href="https://help.talend.com/">here</a>.</p><p>Talend can transfer data while transforming it from one data source to another. It’s as flexible as your imagination - so you could combine data from multiple sources, and transfer the computed and transformed data to multiple destinations.</p><p>Things I use(d) Talend for:</p><ul><li>Parse data files and upsert databases with the data<li>Syncornize databases / data sources<li>Replicate data sources for reporting and/or data warehousing<li>Consuming APIs to update databases</ul><h1 id="bi-reporting-data-warehousing">BI, Reporting, Data Warehousing</h1><p>For many of us, these are all in the same bucket. Small to medium businesses simply want their reports to work. They have tons of data sources, but no great way to digest it all.</p><p>One solution I really love is Talend and Metabase. Both free and powerful. Set up your Metabase dedicated linux server, and put some databases on it. It’s a really pretty solution for BI, Reporting, and Warehousing. Well, Metabase isn’t really for warehousing, but they do hold hands.</p><h2 id="the-metabase-server">The Metabase Server</h2><p>For this story we do have a Metabase server as our destination. This is out of scope for this story though. <a href="https://www.metabase.com/">Check it out</a> - it’s neato.</p><hr /><h1 id="story-time">Story Time</h1><p>We begin with Talend already installed, working and configured.</p><p>We have this CSV with Exchange Tracking Log data in it, just the columns we want. We want to dump this data into a Mysql DB under Metabase to do some reports on.</p><p>If I remember correctly, this data was overkill with the future in mind- all I really needed was email counts per user in and out. But hey, I love data so I grabbed what I thought might be handy. Also- the retention of the Mysql DB is going to be a LOT longer than that of the exchange logs.</p><p>So let’s dive in and see how this Talend job was built.</p><h2 id="create-the-job-in-talend">Create the job in Talend</h2><p>Create a new job in your desired location. For myself, I group jobs by either system or database type, with sub-types for complex jobs that may have multiple versions. <br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/00.png" alt="00" class="normal" /></p><p>Fill in the fields you wish to. Keep in mind the version field for later- if you increment that on a big change you can roll back if needed to an earlier version.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/01.png" alt="01" class="normal" /></p><h2 id="set-the-stage">Set the stage</h2><p>Once we have our job in front of us, we go and find the components we will need. In this case, we will need <code class="language-plaintext highlighter-rouge">tFileInputDelimited</code> to start, so drag that onto the stage.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/02.png" alt="02" class="normal" /></p><p>Here’s what your stage may look like. I’ve also dragged a <code class="language-plaintext highlighter-rouge">tDBOutput</code> component onto the stage, getting ahead of myself.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/03.png" alt="03" class="normal" /></p><p>Let’s set up the CSV component-</p><ul><li>Click the three dots beside the <code class="language-plaintext highlighter-rouge">File name/Stream</code> field, and go find your file. You can also type in a UNC path.<li>Verify skip empty rows is checked, we don’t want them here.<li>If we wanted to re-use a schema, we could select it now, but in our case we’re building this plane while we fly it, so we’ll build that momentarily.</ul><p>Can you spot the mistake I made here? We’ll come back to it.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/04.png" alt="04" class="normal" /></p><p>Click over to the view tab in the component tab. This is where we change the labels and hover-text. Give it appropriate data, future you will thank you.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/050.png" alt="050" class="normal" /><br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/05.png" alt="05" class="normal" /></p><h2 id="test-setup">Test setup</h2><p>Now, before we start throwing data willy-nilly at a database, let’s test some things. The common way to do this with almost any component, is to use a <code class="language-plaintext highlighter-rouge">tLogRow</code> component as your destination/output.</p><p>Drag a <code class="language-plaintext highlighter-rouge">tLogRow</code> component onto the stage, in between the CSV and DB components. Then, Right click on the CSV component, and grab its main output row - then click the <code class="language-plaintext highlighter-rouge">tLogRow</code> to connect them.<br /> <em>ProTip: Right click-dragging from a component defaults to grabbing the row-main output.</em> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/06.png" alt="06" class="normal" /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/07.png" alt="07" class="normal" /></p><p>Now our <code class="language-plaintext highlighter-rouge">tLogRow</code> will catch all of the output from the CSV input.</p><h2 id="create-a-csv-schema">Create a CSV schema</h2><p>Before we can gobble up the CSV, we need to tell the component what to expect in the thing. Better practice is to always make a schema, don’t just build it in the component on the fly.</p><p>To do that, use the left nav to find the <strong>Metadata</strong> area. Under File delimited- Create folders as you like/if you wish, and create a new file delimited schema via right click-&gt;create.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/08.png" alt="08" class="normal" /></p><p>Name the schema, and all that jazz.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/09.png" alt="09" class="normal" /></p><p>Grab the CSV, and don’t worry about the preview of the data yet.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/10.png" alt="10" class="normal" /></p><p>Configure all of your delimiters, and separators.<br /> The shot below should work for the exchange logs - but if you’re using the story as a guide for some other CSV, change this as necessary.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/11.png" alt="11" class="normal" /></p><p>Next step-<br /> Guess the schema. It gets pretty darn close to what you want straight away.<br /> You may need/want to tweak some of this though- for instance, the length column for each field and type.<br /> I recommend increasing the Length allowance where you think it may be an issue.<br /> Also take a look at the type column- <strong><em>the type isn’t just for looks - the data will be expected to follow the type set for it</em></strong>.<br /> We will modify this as we go along as well- it’s not set in stone.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/12.png" alt="12" class="normal" /></p><p>If you change the schema, then click finish- you will be warned about the preview. That’s ok.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/13.png" alt="13" class="normal" /></p><p>There’s our schema- we can use this in any job, duplicate it and edit it etc.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/14.png" alt="14" class="normal" /></p><h2 id="assign-the-schema">Assign the Schema</h2><p>Back in the CSV component - change the schema from <code class="language-plaintext highlighter-rouge">Built-In</code> to <code class="language-plaintext highlighter-rouge">Repository</code>, and select the one you just built.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/15.png" alt="15" class="normal" /></p><p>You will see this pop up a lot. Any time you change the definition of the data, it will ask if you want to propagate changes.<br /> This can be dangerous- as sometimes propagation includes other jobs that use the same schema. So be careful- but normally, this is a very handy feature.<br /> Essentially it will push the schema definition to all the components affected by it. (We’ll say yes)<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/16.png" alt="16" class="normal" /></p><p>Almost time for fun stuff- Click on the <code class="language-plaintext highlighter-rouge">tLogRow</code> component, and go edit it’s schema in it’s component tab.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/17.png" alt="17" class="normal" /></p><p>Here we can see what propagation did for us- everything is identical. Nice.</p><h2 id="runtest-the-job">Run/Test the job</h2><p>Click ok, and then click the Run tab near the component tab and click Run. It will build and execute.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/18.png" alt="18" class="normal" /></p><p>The mistake I made earlier? Yea, if you missed it too you’ll see this:<br /> <code class="language-plaintext highlighter-rouge">Couldn't parse value for column 'RecipientCount' in 'row1', value is '"1"'. Details: java.lang.NumberFormatException: For input string: ""1""</code><br /> I forgot to enable CSV options- and talend automatically wrapped most of my values in double quotes, essentially double-double quoting everything.<br /> Back to the component tab for the CSV- check off that CSV options box, and run the job again.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/19.png" alt="19" class="normal" /></p><p>Inspect output via the Run tab, that is created by the <code class="language-plaintext highlighter-rouge">tLogRow</code> component.<br /> I don’t seem to have screenshots here for the config of the <code class="language-plaintext highlighter-rouge">tLogRow</code> - but they’re fairly straight forward. Tell it to output in a simple table like this, and run the job again if necessary. <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/20.png" alt="20" class="normal" /></p><h2 id="configure-and-connect-the-db-component">Configure and connect the DB component</h2><p>Ok so the data looks sane from the log, so let’s set up the DB component.<br /> Select MySql if you’re following along, and click Apply. This will then show relevant options for it’s configuration.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/21.png" alt="21" class="normal" /></p><p>DB name here is the name of the DB you created.<br /> I find the utf8mb4 and unicode_ci to be the safest character set/collation, generally.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/22.png" alt="22" class="normal" /></p><p>Time to create another schema! Well, sort of. We’re created connection details.<br /> Under your Db Connections in your Metadata. Fill in all the thingies on the first step.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/23.png" alt="23" class="normal" /></p><p>Second step is way cooler. <br /> The default connection string will work most of the time. But sometimes it gives us a headache due to times and timezone.<br /> After you put in your login information, add some additional parameters for safety: <code class="language-plaintext highlighter-rouge">noDatetimeStringSync=true&amp;serverTimezone=&lt;YOUR TIMEZONE&gt;</code><br /> Test and Finish.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/24.png" alt="24" class="normal" /></p><p>Yay<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/25.png" alt="25" class="normal" /></p><p>Back over to the DB component - grab the new connection details via the ‘Property Type’ -&gt; Repository -&gt; …<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/26.png" alt="26" class="normal" /></p><h2 id="db-component-table-actions">DB component table actions</h2><p>After that is pulled in- take a close look at the options we have here under ‘Action on table’ and ‘Action on data’.<br /> Because we want to only keep unique rows, let’s use <strong><em>Insert Ignore</em></strong>. This lets us be a bit loose and fast with the data-sync, allowing overlapping data because it will simply be discarded if a conflict occurs.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/27.png" alt="27" class="normal" /></p><p>Grab your main row again from the csv, and attach it to your DB component. Then, you can ‘sync columns’ to generate a schema on the DB component.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/28.png" alt="28" class="normal" /></p><p>Sadly, this is not good enough. Trial and error would have told you the data is not clean enough to simply throw at the DB from the CSV.</p><h2 id="the-magical-tmap-component">The magical tMap component</h2><p>So, a component you would be painfully familiar with after a while in Talend will come in next: The <code class="language-plaintext highlighter-rouge">tMap</code>. It’s magical.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/29.png" alt="29" class="normal" /></p><p>Connect your CSV to the ‘tMap’ and then try to grab the main row from it. It will ask for a name - this is arbitrary.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/30.png" alt="30" class="normal" /></p><p>Then, here’s why we did it in this order- now we can grab the schema from both sides.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/31.png" alt="31" class="normal" /></p><p>Double click your <code class="language-plaintext highlighter-rouge">tMap</code> component, and behold your savior and/or nightmare depending on the situation.<br /> This component really is a blessing- as long as you’re familiar with Java, you can make miracles happen here.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/32.png" alt="32" class="normal" /></p><h2 id="mapping-and-transforming-in-the-tmap">Mapping and transforming in the tMap</h2><p>So the first step usually is to slam the ‘Auto map!’ button on the right. In our case it should match up everything nicely 1:1.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/33.png" alt="33" class="normal" /></p><p>Now our first problem- the Timestamp from our CSV is not OK and needs some tweaking. Change the ‘out’ side of the schema to Date type- with the pattern <strong>“yyyy-MM-dd HH:mm:ss”</strong>.<br /> This doesn’t convert the thing for us from a string, we need java for that, but if the source data was a proper ‘date’ (8601 or similar) then it would.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/34.png" alt="34" class="normal" /></p><p>So to hand it proper data, let’s inject an expression in it- <br /> On the ‘out’ side, click the … beside the row1.Timestamp<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/35.png" alt="35" class="normal" /></p><p>Neat little ISE here huh?<br /> <code class="language-plaintext highlighter-rouge">TalendDate.parseDate("MM/dd/yyy HH:mm",row1.Timestamp)</code> as our expression- will interpret the CSV date, as a java date proper.<br /> The schema on the out side will then store it in the format we told it to. <br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/36.png" alt="36" class="normal" /></p><h2 id="test-the-map">Test the map</h2><p>Run the <code class="language-plaintext highlighter-rouge">tMap</code> into the <code class="language-plaintext highlighter-rouge">tLogRow</code> to check that our expression worked:<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/37.png" alt="37" class="normal" /></p><p>Doublecheck the DB type on the DB component is DATETIME for the Timestamp column, and re-connect the <code class="language-plaintext highlighter-rouge">tMap</code> to the DB component.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/38.png" alt="38" class="normal" /></p><h2 id="a-note-about-unique-rows-with-the-exchange-tracking-log">A note about unique rows with the Exchange tracking log</h2><p>Now a bit of an asside-</p><p>After populating the DB with the tracking data- I saw some messages show up more than once even though we’ve narrowed the events.<br /> This is not helpful for index purposes, so because we already have the job set to insert ignore- we can truncate the table- make our unique indexes, then re-populate the table.</p><p>For the sake of statistics, I think it’s fair to exclude true duplicates. Many duplicates I found were mailboxhealth emails, and many others seemed strange even when looking at the full data- e.g. 4 ‘deliver’ events for a single message id from a single sender to a single recipient all with the exact same data including subject. I’m not sure if that was my csv import acting strangely or not. In any case we can create a unique index to weed all of these out, and rely on ‘insert ignore’ to skip the duplicates.<br /> After doing this, and reviewing the data- it’s acceptable but still not perfect. This will be a work in progress to find the best unique index without generating some sort of true PK.</p><h2 id="indexes-on-the-db-to-prevent-duplicates">Indexes on the DB to prevent duplicates</h2><p>Indexes I made are simple, one for unique rows, and one for better lookups:<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/39.png" alt="39" class="normal" /><br /> Repeat the above on your database as well, if you want to eliminate duplicate rows as I did.</p><p>Test! Success! I hope! <br /> Talend is wicked fast eh?<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/40.png" alt="40" class="normal" /></p><p>Now to build and schedule the job.</p><h2 id="build-the-job">Build the job</h2><p>For the uninitiated - Talend is just a workshop. You don’t need it running all the time, or even on the machine that will be running these tasks.<br /> We can compile these jobs into executables that stand alone - sweet!</p><p>So in the left nav, find your job, right click, Build Job.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/41.png" alt="41" class="normal" /></p><p>Save the job to where you want, and tell it to create All shell launchers, items, and sources.<br /> This will produce a OS fluid package of files, in which Java launches a little VM, does its job, and shuts down.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/42.png" alt="42" class="normal" /></p><p>Here’s the output. <br /> If you get into more complex jobs that require context, or environment variables, you may store some config files here in the root too.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/43.png" alt="43" class="normal" /></p><p>Clicking into the job folder, you’ll see the launchers- java (jar), windows bat, powershell, and bash (sh).<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/44.png" alt="44" class="normal" /></p><p>In our case we’re on a windows VM - so we’ll automate this via the task scheduler, and the .bat file.</p><h2 id="automate-the-job">Automate the job</h2><p>Create a task in task scheduler, and set it up similar to the following. Your user does not need to be the user in the database config.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/45.png" alt="45" class="normal" /></p><p>In my case, I wanted this task to run once a day, just a bit after midnight. Because in my case, I wanted to grab the previous day worth of tracking logs, and append the DB.<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/46.png" alt="46" class="normal" /></p><p>Because we’re using the .bat file- no special arguments are needed. Sweet!<br /> <img data-proofer-ignore data-src="/assets/img/post images/etl/exch mtl to mysql/47.png" alt="47" class="normal" /></p><h1 id="conclusion">Conclusion</h1><p>So this was a pretty simple example of a Talend Job, but what we accomplished was pretty cool!</p><ul><li>A powershell script to automatically pull exchange logs (<a href="/posts/Extract-Exchange-message-tracking-logs-with-powershell/">Different post</a>)<li>A Talend job to take the output, transform it, and insert it into a Database<li>All automatically, on a regular schedule.</ul><p>If you have any BI tools on top of, or integrated with, the DB in question here- you now have a dataset for reporting basic email data from your exchange server.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/etl/'>ETL</a>, <a href='/categories/talend/'>Talend</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/etl/" class="post-tag no-text-decoration" >etl</a> <a href="/tags/powershell/" class="post-tag no-text-decoration" >powershell</a> <a href="/tags/sysadmin/" class="post-tag no-text-decoration" >sysadmin</a> <a href="/tags/talend/" class="post-tag no-text-decoration" >talend</a> <a href="/tags/mysql/" class="post-tag no-text-decoration" >mysql</a> <a href="/tags/exchange/" class="post-tag no-text-decoration" >exchange</a> <a href="/tags/metabase/" class="post-tag no-text-decoration" >metabase</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Transfer Exchange message tracking logs to Mysql with Talend Open Studio - Bwilliamson's Blog&url=https://bwilliamson55.github.io/posts/Transfer-Exchange-message-tracking-logs-to-Mysql-with-Talend-Open-Studio/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Transfer Exchange message tracking logs to Mysql with Talend Open Studio - Bwilliamson's Blog&u=https://bwilliamson55.github.io/posts/Transfer-Exchange-message-tracking-logs-to-Mysql-with-Talend-Open-Studio/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://bwilliamson55.github.io/posts/Transfer-Exchange-message-tracking-logs-to-Mysql-with-Talend-Open-Studio/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Magento-2-Data-Patches/">Magento 2 Data Patches</a><li><a href="/posts/Xdebug-3-and-Magento-2/">Xdebug 3 and Magento 2</a><li><a href="/posts/Renewing-a-RDS-or-RDG-SSL-certificate-with-Godaddy-SSL/">Renewing a RDS/RDG SSL certificate with Godaddy SSL</a><li><a href="/posts/Profiles,-Bashrc,-and-Zshrc/">Profiles, Bashrc, and Zshrc</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/powershell/">powershell</a> <a class="post-tag" href="/tags/magento/">magento</a> <a class="post-tag" href="/tags/sysadmin/">sysadmin</a> <a class="post-tag" href="/tags/exchange/">exchange</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/etl/">etl</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/windows-server/">windows server</a> <a class="post-tag" href="/tags/bashrc/">bashrc</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Extract-Exchange-message-tracking-logs-with-powershell/"><div class="card-body"> <span class="timeago small" >Aug 22<i class="unloaded">2021-08-22T19:17:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Extract Exchange message tracking logs with powershell</h3><div class="text-muted small"><p> Exchange makes it kind of difficult to do complicated reporting without third party tools. This post will show how to extract the message logs useful data. For the purpose of this post, we are not...</p></div></div></a></div><div class="card"> <a href="/posts/Installing-Godaddy-SSL-cert-on-Exchange-2013/"><div class="card-body"> <span class="timeago small" >Aug 20<i class="unloaded">2021-08-20T11:18:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Installing a Godaddy SSL certificate on Exchange 2013</h3><div class="text-muted small"><p> You may or may not be surprised at how many people are still using Exchange 2013. They still need SSL like every other public facing service, so here’s how to do that. In this situation we are ass...</p></div></div></a></div><div class="card"> <a href="/posts/Renewing-a-RDS-or-RDG-SSL-certificate-with-Godaddy-SSL/"><div class="card-body"> <span class="timeago small" >Aug 20<i class="unloaded">2021-08-20T10:45:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Renewing a RDS/RDG SSL certificate with Godaddy SSL</h3><div class="text-muted small"><p> This is a quick walkthrough on how to do this. This was written for Windows server 2012R2, but should still be applicable to 2016 and 2019 as well. This is specifically for an RDG (Remote Desktop G...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Extract-Exchange-message-tracking-logs-with-powershell/" class="btn btn-outline-primary" prompt="Older"><p>Extract Exchange message tracking logs with powershell</p></a> <a href="/posts/Magento-2-Data-Patches/" class="btn btn-outline-primary" prompt="Newer"><p>Magento 2 Data Patches</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//bwilliamson.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Transfer Exchange message tracking logs to Mysql with Talend Open Studio'; this.page.url = 'https://bwilliamson55.github.io/posts/Transfer-Exchange-message-tracking-logs-to-Mysql-with-Talend-Open-Studio/'; this.page.identifier = '/posts/Transfer-Exchange-message-tracking-logs-to-Mysql-with-Talend-Open-Studio/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/bwilliamson55">Bwilliamson</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/powershell/">powershell</a> <a class="post-tag" href="/tags/magento/">magento</a> <a class="post-tag" href="/tags/sysadmin/">sysadmin</a> <a class="post-tag" href="/tags/exchange/">exchange</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/etl/">etl</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/windows-server/">windows server</a> <a class="post-tag" href="/tags/bashrc/">bashrc</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://bwilliamson55.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Q6X18HXBYM"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Q6X18HXBYM'); }); </script>
